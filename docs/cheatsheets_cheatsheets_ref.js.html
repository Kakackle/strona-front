<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cheatsheets/cheatsheets_ref.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cheatsheets/cheatsheets_ref.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file cheatsheets_ref.js - main js file of the cheatshets subpage
 * @author MM
 * @see &lt;a href="https://google.com"> Google &lt;/a>
 */

// elementy programu:
// 1. przechowywanie db linkow w postaci tabeli i w localstorage
// 2. tworzenie elementow DOM na podstawie tabeli
// 3. filtracja tablic przed renderem
// 4. obsluga zdarzen dodawania, usuwania, edycji linkow/obiektow

// TODO: edycja pol, tagow itd
// TODO: sledzenie ilosci klikniec jest, ale poniewaz najpierw otwiera link, to nie aktualizuje sie na stronie bez refreshu?
// TODO: sortowanie, po dacie, kliknieciach
// TODO: upiekszenie, bo teraz wyglada bardzo roboczo, nie chcialbym korzystac z tego, zbyt malo przejrzyste, zbite
// TODO: paginacja, mam funkcje render, moze moge podzielic tablice i wywolywac funckje z podawaniem jej czesci
// TODO: dodawanie z pliku json bezposrednio a nie przez tekst?
// TODO: zastanowic sie, ze renderowanie calej strony rzadko jest tak naprawde potrzebne
// duzo czesciej, wymagane jest dodanie tylko jednego obiektu albo zmiana jednego pola
// co jest latwe samo w sobie, ale czy nie da sie tego zrealizowac jakos w funkcji
// bo inaczej moze sie troche zbyt rozdrobnic we wlasne funkcje do zmiany kazdej malej rzeczy

/**
 * Arrays of cheatsheet objects - See {@tutorial general-tutorial}
 * @type {Array}
 */
let cheatsheets = []; //tablica linkow w systemie
let tags = []; //tablica tagow
let appliedTags = []; //tagi do filtracji

//------------- elementy DOM -------------
//localStorage
const clearButton = document.querySelector(".clear-button");
const exampleButton = document.querySelector(".example-button");

//otworz sekcje dodawania linkow
const add_new_link = document.querySelector(".add-section-title");
const add_json = document.querySelector(".json-title");
//dropdown obszar wpisywania danych linkow
const add_dropdown = document.querySelector(".add-drop");
const add_json_dropdown = document.querySelector(".add-drop-json");
const title_input = document.querySelector(".add-title");
const link_input = document.querySelector(".add-link");
const tag1_input = document.querySelector(".add-tag1");
const tag2_input = document.querySelector(".add-tag2");
const tag3_input = document.querySelector(".add-tag3");
const favCheckbox = document.querySelector(".add-fav-check");
const json_text_input = document.querySelector(".json-text");
//submit dodawania
const link_submit_button = document.querySelector(".submit-link");
const submit_json = document.querySelector(".submit-json");
const close_dropdown = document.querySelector(".close-drop");
const close_drop_json = document.querySelector(".close-drop-json");

//obszary do renderowania
const fav_area = document.querySelector(".fav-area");
const most_links = document.querySelector(".most-links");
const all_links = document.querySelector(".all-links");

//wszystkie linki - do obslugi eventow na kliknieciu ich w dowolnym miejscu na stronie
let all_link_elements = [];
//obszar tagow
const type_tags = document.querySelector(".type-tags");
let tag_checkboxes = document.querySelectorAll(".tag-checkbox-box");
const filterButton = document.querySelector(".filter-button");

//searchbar
const fav_search = document.querySelector(".fav-search");

/**
 * Cheatsheet object
 * @typedef {Object} Cheat
 * @property {string} title - link title text
 * @property {string} link - link text
 * @property {Array&lt;string>} tags - array of tags
 * @property {string} date - autogenerated date of creation
 * @property {string} dateLast - auto date of last interaction
 * @property {boolean} isFav - is link added to favs
 */
// ------------ 1. Obsluga dodawania i usuwania ----------

//tworzenie i zwracanie obiektu cheatsheetu
/**
 *
 * @param {string} title - the title of the link
 * @param {string} link - hyperlink in string format
 * @param {Array&lt;string>} tags - array of 3 string values with link tags
 * @param {boolean} isFav - will link be added to favourites
 * @returns {Cheat} cheatsheet object with title, link, tags, date, dateLast, clicks and isFav fields
 */
const createNewCheatsheet = function (title, link, tags, isFav) {
  const date = new Date();
  /**
   * @type {Cheat}
   */
  const cheat = {
    title: title,
    link: link,
    tags: tags,
    date: `${date.getDate()}:${date.getMonth() + 1}:${date.getFullYear()}`,
    dateLast: `${date.getDate()}:${date.getMonth() + 1}:${date.getFullYear()}`,
    clicks: 0,
    isFav: isFav,
  };
  return cheat;
};

//zapisz podana liste wraz z nazwa do localstorage
const saveToLocalStorage = function (arr, arr_name) {
  localStorage.setItem(`${arr_name}`, JSON.stringify(arr));
};

// czyszczenie localstorage
const clearStorage = function () {
  localStorage.clear();
};

const getFromLocal = function () {
  const localCheatsheets = JSON.parse(localStorage.getItem("cheatsheets"));
  if (localCheatsheets) cheatsheets = localCheatsheets;
  else cheatsheets = [];
  const localTags = JSON.parse(localStorage.getItem("cheatsheets"));
  if (localTags) tags = localTags;
  else tags = [];
};

//czyszczenie linkow i tagow
const clearObjects = function () {
  cheatsheets = [];
  tags = [];
};

//--------- obsluga dodania/usuwania elementow tablic --------

const deleteEntry = function (e) {
  const counterIndex =
    e.target.parentNode.querySelector(".counter-el").innerHTML;
  console.log(counterIndex);
  cheatsheets.splice(counterIndex, 1);
  renderWebsite();
  saveToLocalStorage(cheatsheets, "cheatsheets");
};

//dodanie od fav poprzez zmienienie isFav, czyli aktualizacje obiektu z cheatsheets
//i tak samo usuniecie, przy czym usuniecie tylko na przycisku w sekcji fav, dodanie w listach
const removeFav = function (e) {
  const counterIndex =
    e.target.parentNode.querySelector(".counter-el").innerHTML;
  console.log(counterIndex);
  cheatsheets[counterIndex].isFav = false;
  renderFavLinksEntries(cheatsheets);
};
const addFav = function (e) {
  const counterIndex =
    e.target.parentNode.parentNode.querySelector(".counter-el").innerHTML;
  console.log(counterIndex);
  cheatsheets[counterIndex].isFav = true;
  renderFavLinksEntries(cheatsheets);
  createEventListeners();
  saveToLocalStorage(cheatsheets, "cheatsheets");
};

//// zebranie istniejacych tagow, moze powinno byc wywolywane przy dodawaniu
//TODO: dodawanie tagow przy dodawaniu obiektu a nie po fakcie
const gatherTags = function () {
  cheatsheets.forEach((cheat) => {
    cheat.tags.forEach((tag) => {
      if (!tags.includes(tag)) tags.push(tag);
    });
  });
  saveToLocalStorage(tags, "tags");
};

// --------- 2. render elementow tabel ---------

//tabela linkow wszystkich template
//TODO: all i most sa praktycznie identyczne w tym momencie, kod ten sam
//  ale moze mozna wymyslic jakies roznice, a jesli nie to w jedna funkcje
const renderAllLinksEntries = function (renderList) {
  all_links.innerHTML = ``;
  renderList.forEach((cheat) => {
    const all_li = document.createElement("li");
    all_li.innerHTML = `
    &lt;div class="li-div">
    &lt;p data-count="${renderList.indexOf(cheat)}"
    class="hidden counter-el">${renderList.indexOf(cheat)}&lt;/p>
    &lt;p>
    &lt;a
      class="link-copy most-div-head-long"
      href="${cheat.link}"
      target="_blank"
      rel="noopener noreferrer"
      >${cheat.title}&lt;/a
    >
    &lt;/p>
    &lt;div class="most-link-tags most-link-short">
      &lt;span>${cheat.tags[0]}&lt;/span>
      &lt;span>${cheat.tags[1]}&lt;/span>
      &lt;span>${cheat.tags[2]}&lt;/span>
    &lt;/div>
    &lt;p class="click-counter">${cheat.clicks} cl.&lt;/p>
    &lt;p>${cheat.date}&lt;/p>
    &lt;p>${cheat.dateLast}&lt;/p>
    &lt;ion-icon class="most-delete md hydrated" name="trash-bin" role="img" aria-label="trash bin">&lt;/ion-icon>
    &lt;ion-icon class="most-addfav md hydrated" name="checkmark" role="img" aria-label="checkmark">&lt;/ion-icon>
    &lt;/div>
    `;
    all_links.appendChild(all_li);
  });
};

const renderMostClickedEntries = function (renderList) {
  most_links.innerHTML = ``;
  renderList.forEach((cheat) => {
    const most_li = document.createElement("li");
    most_li.innerHTML = `
    &lt;div class="li-div">
    &lt;p data-count="${renderList.indexOf(cheat)}"
    class="hidden counter-el">${renderList.indexOf(cheat)}&lt;/p>
    &lt;p>
      &lt;a
        class="link-copy most-div-head-long"
        href="${cheat.link}"
        target="_blank"
        rel="noopener noreferrer"
        >${cheat.title}&lt;/a
      >
      &lt;/p>
      &lt;div class="most-link-tags most-link-short">
        &lt;span>${cheat.tags[0]}&lt;/span>
        &lt;span>${cheat.tags[1]}&lt;/span>
        &lt;span>${cheat.tags[2]}&lt;/span>
      &lt;/div>
      &lt;p class="click-counter">${cheat.clicks} cl.&lt;/p>
      &lt;p>${cheat.date}&lt;/p>
      &lt;p>${cheat.dateLast}&lt;/p>
      &lt;ion-icon class="most-delete md hydrated" name="trash-bin" role="img" aria-label="trash bin">&lt;/ion-icon>
      &lt;ion-icon class="most-addfav md hydrated" name="checkmark" role="img" aria-label="checkmark">&lt;/ion-icon>
    &lt;/div>`;
    most_links.appendChild(most_li);
  });
};

const renderFavLinksEntries = function (renderList) {
  //reset do stanu poczatkowego z predefiniowanym elementem na czas testow
  fav_area.innerHTML = ``;
  const favCheatsheets = renderList.filter((cheat) => cheat.isFav === true);
  favCheatsheets.forEach((cheat) => {
    const fav_div = document.createElement("div");
    fav_div.classList.add("fav"); //klasa glowna
    // cheat.tags.forEach((tag) => fav_div.classList.add(`${tag}`)); //klasy tagow
    //pierwszy tag jako definujacy wyglad?
    fav_div.classList.add(`${cheat.tags[0]}-border`);
    fav_div.innerHTML = `
    &lt;p data-count="${renderList.indexOf(cheat)}"
    class="hidden counter-el">${renderList.indexOf(cheat)}&lt;/p>
    &lt;p class="fav-title">${cheat.title}&lt;/p>
      &lt;p class="fav-link">
        &lt;a
          class="link-copy"
          href="${cheat.link}"
          target="_blank"
          rel="noopener noreferrer"
          >${cheat.link}&lt;/a
        >
      &lt;/p>
      &lt;div class="fav-applied-tags">
        &lt;span class="fav-tag ${cheat.tags[0]}"> ${cheat.tags[0]} &lt;/span>
        &lt;span class="fav-tag ${cheat.tags[1]}"> ${cheat.tags[1]} &lt;/span>
        &lt;span class="fav-tag ${cheat.tags[2]}"> ${cheat.tags[2]} &lt;/span>
      &lt;/div>
      &lt;span class="fav-date">${cheat.date}&lt;/span>
      &lt;span class="fav-clicks click-counter">${cheat.clicks} cl.&lt;/span>
      &lt;ion-icon class="fav-icon fav-delete" name="trash-bin">&lt;/ion-icon>
      &lt;ion-icon class="fav-icon fav-remove" name="close">&lt;/ion-icon>`;
    fav_area.appendChild(fav_div);
  });
};

const renderTags = function () {
  type_tags.innerHTML = `&lt;p class="tag-sect-title">Link type:&lt;/p>`;
  tags.forEach((tag) => {
    const tag_checkbox = document.createElement("div");
    tag_checkbox.classList.add("tag-checkbox");
    tag_checkbox.innerHTML = `&lt;input
    class="tag-checkbox-box"
    type="checkbox"
    id="${tag}"
    name="${tag}"
    value="${tag}"
  />
  &lt;label class="tag-checkbox" for="${tag}"> ${tag} &lt;/label>
    `;
  });
  //aktualizacja tag checkboxes
  tag_checkboxes = document.querySelectorAll(".tag-checkbox-box");
};

//create event listeners on links in tables
const createEventListeners = function () {
  const mostDeleteList = document.querySelectorAll(".most-delete");
  mostDeleteList.forEach((most_delete) => {
    most_delete.addEventListener("click", (e) => {
      deleteEntry(e);
    });
  });
  const mostAddFavList = document.querySelectorAll(".most-addfav");
  mostAddFavList.forEach((most_addfav) => {
    most_addfav.addEventListener("click", (e) => {
      addFav(e);
    });
  });
  const favDeleteList = document.querySelectorAll(".fav-delete");
  favDeleteList.forEach((fav_delete) => {
    fav_delete.addEventListener("click", (e) => {
      deleteEntry(e);
    });
  });
  const favRemoveList = document.querySelectorAll(".fav-remove");
  favRemoveList.forEach((fav_remove) => {
    fav_remove.addEventListener("click", (e) => {
      removeFav(e);
    });
  });
  collectLinks();
  all_link_elements.forEach((link_elem) => {
    link_elem.addEventListener("click", (e) => {
      e.stopPropagation();
      countClick(e);
    });
  });
};

//render wszystkich grup obiektow na stronie
const renderWebsite = function () {
  renderMostClickedEntries(cheatsheets);
  renderAllLinksEntries(cheatsheets);
  renderFavLinksEntries(cheatsheets);
  renderTags();
};

//reset inputow dodawania
const resetAddInputs = function () {
  title_input.value = "";
  link_input.value = "";
  tag1_input.value = "";
  tag2_input.value = "";
  tag3_input.value = "";
};

// collect all link elements for event listeners
const collectLinks = function () {
  // let fav_links = document.querySelectorAll(".fav-link");
  // let table_links = document.querySelectorAll(".link-copy");
  // all_link_elements = fav_links.concat(table_links);
  all_link_elements = document.querySelectorAll(".fav-link, .link-copy");
};

//zliczanie klikniecia i aktualizacja tekstu
const countClick = function (e) {
  //selekcja obiektu
  const counterIndex =
    e.target.parentNode.parentNode.querySelector(".counter-el").innerHTML;
  console.log(counterIndex);
  cheatsheets[counterIndex].clicks += 1;
  //wszystkie wystapienia
  const elems = collectByCounter(counterIndex);
  //aktualizacja tekstu
  elems.forEach((el) => {
    el.parentNode.querySelector(
      ".click-counter"
    ).textContent = `${cheatsheets[counterIndex].clicks} cl.`;
  });
  console.log(
    `counter: ${counterIndex}, clicks: ${cheatsheets[counterIndex].clicks}`
  );
  saveToLocalStorage(cheatsheets, "cheatsheets");
};

//collect and actualize all fav-clicks elements by data value
const collectByCounter = function (count) {
  const elems = document.querySelectorAll(`[data-count="${count}"]`);
  return elems;
};

// ----------- filtracja -------------
// aplikacja filtrow z tagow
const filterByTags = function () {
  appliedTags = [];
  tag_checkboxes.forEach((tag) => {
    if (tag.checked) appliedTags.push(tag.value);
  });
  let renderList = [];
  if (appliedTags.length === 0) {
    renderList = cheatsheets;
  } else {
    renderList = cheatsheets.filter(
      (cheat) =>
        appliedTags.includes(cheat.tags[0]) ||
        appliedTags.includes(cheat.tags[1])
    );
  }
  return renderList();
};

const filterBySearch = function () {
  let searchterm = fav_search.value;
  console.log(searchterm);
  let renderList = [];
  //sprawdzanie po skladowych tagow
  let includesTag = 0;
  cheatsheets.forEach((cheat) => {
    cheat.tags.forEach((tag) => {
      if (tag.includes(searchterm)) includesTag = 1;
    });
  });

  //sprawdzanie czy zawiera tag w calosci
  // cheat.tags.includes(searchterm)

  renderList = cheatsheets.filter(
    (cheat) =>
      cheat.title.includes(searchterm) ||
      cheat.link.includes(searchterm) ||
      cheat.tags.includes(searchterm)
  );
  console.log(cheatsheets[0].tags);
  console.log(cheatsheets[0].tags.includes(searchterm));
  return renderList;
};

// ------------ 4. EventListeners ----------

//obsluga widocznosci menu dodawania linkow
add_new_link.addEventListener("click", (e) => {
  e.preventDefault();
  add_dropdown.style.display = "flex";
});

close_dropdown.addEventListener("click", (e) => {
  e.preventDefault();
  add_dropdown.style.display = "none";
});

add_json.addEventListener("click", (e) => {
  e.preventDefault();
  add_json_dropdown.style.display = "flex";
});

close_drop_json.addEventListener("click", (e) => {
  e.preventDefault();
  add_json_dropdown.style.display = "none";
});

//tworzenie nowych elementow z wypelnionych pol
link_submit_button.addEventListener("click", (e) => {
  const cheat = createNewCheatsheet(
    title_input.value,
    link_input.value,
    [tag1_input.value, tag2_input.value, tag3_input.value],
    favCheckbox.checked
  );
  resetAddInputs();
  cheatsheets.push(cheat);
  saveToLocalStorage(cheatsheets, "cheatsheets");
  renderWebsite();
  createEventListeners();
  collectLinks();
});

//TODO: funkcja parsujaca JSON z textarea json_text_input

const getJsonInput = function () {
  //parse wartosci z pola
  //stworzenie nowych obiektow moze wykorzystujac createnewcheatsheet?
  //zapisywanie tych obiektow do tablicy
  //na koniec do localstorage i render
  //--- kwestie: ---
  //przy czym uzytnik nie podaje wszystkich informacji w tekscie
  //wiec najlepiej wykorzystac gotowa funkcje create
  //a tekst wpakowac w nowy obiekt, a wlasciwie tablice obiektow
  //i potem foreach i wyciagac z niej i wpakowywac w funkcje create
  let json_text = JSON.parse(json_text_input.value);
  // console.log(json_text);
  json_text.forEach((item) => {
    const cheat = createNewCheatsheet(
      item.title,
      item.link,
      [item.tag1, item.tag2, item.tag3],
      item.isFav === "true"
    );
    console.log(cheat);
    cheatsheets.push(cheat);
  });
  saveToLocalStorage(cheatsheets, "cheatsheets");
  renderWebsite();
  createEventListeners();
  collectLinks();
};

submit_json.addEventListener("click", (e) => {
  getJsonInput();
});

//filtracja
fav_search.addEventListener("input", (e) => {
  e.preventDefault();
  renderWebsite(filterBySearch());
});

filterButton.addEventListener("click", (e) => {
  e.preventDefault();
  renderWebsite(filterByTags());
});

clearButton.addEventListener("click", (e) => {
  e.preventDefault();
  clearStorage(); //czysci pamiec
  getFromLocal(); //aktualizuje wewnetrzne dane
  renderWebsite(); //renderuje strone
  collectLinks();
});

exampleButton.addEventListener("click", (e) => {
  addTestObjects();
});

// ---------- call at load -------------
const mainFunc = function () {
  getFromLocal();
  renderWebsite();
  createEventListeners();
};

mainFunc();

// ---------- tests -----------
// predefiniowany obiekt do testow
const addTestObjects = function () {
  const cheat1 = createNewCheatsheet(
    "10 ways to hide elements in CSS",
    "https://www.sitepoint.com/hide-elements-in-css/",
    ["prog", "css", "howto"],
    true
  );
  const cheat2 = createNewCheatsheet(
    "Curated CSS gradients",
    "https://gradients.shecodes.io/ ",
    ["prog", "css", "resources"],
    false
  );
  cheatsheets.push(cheat1);
  cheatsheets.push(cheat2);
  saveToLocalStorage(cheatsheets, "cheatsheets");
  renderWebsite();
  collectLinks();
  createEventListeners();
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="VanillaTilt.html">VanillaTilt</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-general-tutorial.html">Title of the tut</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Event">Event</a></li><li><a href="global.html#Magnifier">Magnifier</a></li><li><a href="global.html#cheatsheets">cheatsheets</a></li><li><a href="global.html#createNewCheatsheet">createNewCheatsheet</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Apr 26 2023 17:13:58 GMT+0200 (czas Å›rodkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
